variables:
  - name: _version
    value: $(VersionMajor).$(VersionMinor).$(VersionPatch).$(Build.BuildId)
  - name: _packageVersion
    value: $(_version)$(PrereleaseLabel)


trigger:
- main

pool: 
  vmImage: ubuntu-latest

stages:
- stage: CI
  displayName: Build and test
  jobs:
    - job: BuildAndTest
      displayName: Build and test
      steps:
      - script: dotnet --version
        displayName: Print dotnet version
      - script: dotnet build /warnaserror --configuration Release -p:Version=$(_version) -p:PackageVersion=$(_packageVersion)
        displayName: Build solution
      - script: ls
        displayName: Print current location
      - script: dotnet test ./DbSafeTests/
        displayName: Tests DbSafe project
      - script: git clone https://github.com/dbsafe/dbsafe-pg-db
        displayName: Checkout test database
        
  